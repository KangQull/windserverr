#!/bin/bash

# Token Bot Telegram dan Chat ID
BOT_TOKEN="7968725041:AAFoadOL1B4mQpzDcMiLNaDfV5IHh4ON51w"
CHAT_ID="1129290807"

# Nama container Docker
CONTAINER_NAME="elixir"

# Fungsi untuk mengirim pesan ke Telegram
send_telegram_notification() {
    local message=$1
    curl -s -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" \
        -d chat_id="$CHAT_ID" \
        -d text="$message" >/dev/null
}

# Mengekstrak log Docker
echo "Mengambil log Docker dari container '$CONTAINER_NAME'..."
LOGS=$(docker logs $CONTAINER_NAME 2>&1)

# Memastikan log berhasil diambil
if [ $? -eq 0 ]; then
    # Jika log terlalu panjang, potong pesan
    if [ ${#LOGS} -gt 4000 ]; then
        LOGS="${LOGS:0:4000}... (Log terpotong)"
    fi
    
    send_telegram_notification "Log dari container '$CONTAINER_NAME':"
    send_telegram_notification "$LOGS"
else
    send_telegram_notification "Gagal mengambil log dari container '$CONTAINER_NAME'. Pastikan container sedang berjalan."
fi
